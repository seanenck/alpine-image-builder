tools  := `pwd` / ".." / "src"
binary := tools / "target" / "alpine-image-builder"
pwd    := `pwd`
target := "build"
admin  := "doas"

default: build

[no-cd]
build:
    cd "{{tools}}" && just
    {{binary}} --config configs/build-image.toml --workdir "{{pwd}}" --output "{{target}}"
    
deps:
    {{admin}} apk add alpine-sdk mtools dosfstools alpine-conf xorriso squashfs-tools grub grub-efi abuild abuild-rootbld

clean:
    rm -rf "{{target}}"

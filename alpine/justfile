tag     := "3.20"
version := tag + ".3"
arch    := "aarch64"
target  := `pwd` / "build/"
binary  := `pwd` / ".." / "target" / "alpine-image-builder"
clone   := target / "aports.git"
scripts := target / "scripts"
url     := "https://gitlab.alpinelinux.org/alpine/aports"

default: build

[no-cd]
build:
    @just scripts
    {{binary}} --config builder.toml --arch {{arch}} --version {{version}} --output {{target}} --aports "{{scripts}}"

scripts:
    @mkdir -p "{{target}}"
    @test -e "{{clone}}" || git clone --depth=1 "{{url}}" "{{clone}}"
    @cp -r "{{clone}}" "{{scripts}}"

clean:
    rm -rf "{{target}}"

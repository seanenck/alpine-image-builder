# Maintainer: Sean Enck <sean@ttypty.com>
pkgname=apk-chroot
pkgver=0.1
pkgrel=1
# arch-install-scripts version
_pkgver=28
pkgdesc="Scripts to aid in running overlaytmpfs cusp Linux"
arch="noarch"
url="https://github.com/archlinux/arch-install-scripts"
license="GPL-2.0-only"
depends="bash coreutils util-linux-misc"
makedepends="m4 asciidoc"
source="
wrapper.in
99.overlay.sh
arch-install-scripts-$_pkgver.tar.gz::https://github.com/archlinux/arch-install-scripts/archive/refs/tags/v$_pkgver.tar.gz
"
options="!check"
builddir="arch-install-scripts-$_pkgver"

prepare() {
  cp "$srcdir/wrapper.in" .
}

build() {
  make
  sed "s#{CMD}#/sbin/apk#g" wrapper.in > apk-wrapper
  sed "s#{CMD}#/usr/bin/vi#g" wrapper.in > vi-wrapper
}

package() {
  mkdir -p "$pkgdir/etc/profile.d" "$pkgdir/usr/sbin/" "$pkgdir/usr/lib/cusp-apk/bin"
  install -Dm755 "$srcdir/$builddir/apk-wrapper" "$pkgdir/usr/lib/cusp-apk/bin/apk"
  install -Dm755 "$srcdir/$builddir/vi-wrapper" "$pkgdir/usr/lib/cusp-apk/bin/vi"
  install -Dm755 "$srcdir/$builddir/arch-chroot" "$pkgdir/usr/sbin/arch-chroot"
  install -Dm644 99.overlay.sh "$pkgdir/etc/profile.d/99.overlay.sh"
}

sha512sums="
09a027b04b70e01ccd1fd82e3a443c876bdf978b94a922de9dea4dbc187360460ea35720816724b72fc31b02338b11bf39b47ec9156518a8a3ade000530bf1df  arch-install-scripts-28.tar.gz
0a1187abd260e1f3915caf4bab0820f8caca27083ddb86144c1dcf47e81e3fcf828d1bdb0715db077c4a5985a8995947e1953f8a0a1f5d6e5225f88aa2254c5d  99.overlay.sh
85305aede09116862c6bf353188fce805aa5c32a69917055f8ebdb0766045b2187c288f8e8d81e7e5517441fe4e943af225b2a3785692c02cedcab14dee5d005  wrapper.in
"
